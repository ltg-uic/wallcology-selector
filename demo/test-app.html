<html>
<head>
    <link href="../../polymer/polymer.html" rel="import">
    <link href="../wallcology-selector.html" rel="import">
    <link href="../paper-button/paper-button.html" rel="import">

    <link href="../../nutella-connector/nutella-connector.html" rel="import">
    <link href="../styles/shared-styles.html" rel="import">


</head>

<dom-module id="test-app">
    <style include="shared-styles"></style>
    <template>
        <!--<nutella-connector connected={{connected}} id="nutellaConn" hostname="ltg.evl.uic.edu" appid="wallcology"-->
                           <!--runid="default"></nutella-connector>-->

        <div class="horizontal-section-container">

            <div class="horizontal-section">
        <wallcology-selector id="ws" toggle-selectors="{{toggleSelectors}}" button-selectors={{buttonSelectors}}
                             max-selections="13" selected-items="{{selectedItems}}"
                             current-toggle="{{currentToggle}}"></wallcology-selector>
            </div>
        </div>


        <paper-button class="colorful" on-tap="forceMe"><span>force to ?</span></paper-button>

        <template id="test" is="dom-repeat" items="{{selectedItems}}">
            <span>{{item.index}}</span>
        </template>
    </template>

    <script>
        // element registration
        Polymer({
            is: 'test-app',

            // add properties and methods on the element's prototype
            properties: {
                // declare properties for the element's public API
                selectedItems: {
                    type: Array,
                    notify: true,
                    value: []
                },
                currentToggle: {
                    type: Object,
                    notify: true,
                    value: {},
                    observer: 'currentToggleChanged'
                },
                toggleSelectors: {
                    type: Array,
                    notify: true,
                    value: [
                        {
                            "items": [
                                0,
                                1,
                                2,
                                3,
                                4,
                                5,
                                6,
                                7,
                                8,
                                9,
                                10,
                                11,
                                12
                            ],
                            "name": "Habitat 1",
                            "index": 0,
                            "temperature": 0,
                            "pipelength": 0,
                            "brickarea": 0
                        },
                        {
                            "items": [
                                0,
                                1,
                                2,
                                3,
                                4,
                                5,
                                6,
                                7,
                                8,
                                9,
                                10,
                                11,
                                12
                            ],
                            "name": "Habitat 2",
                            "index": 1,
                            "temperature": 0,
                            "pipelength": 0,
                            "brickarea": 0
                        },
                        {
                            "items": [
                                0,
                                1,
                                2,
                                3,
                                4,
                                5,
                                6,
                                7,
                                8,
                                9,
                                10,
                                11,
                                12
                            ],
                            "name": "Habitat 3",
                            "index": 2,
                            "temperature": 0,
                            "pipelength": 0,
                            "brickarea": 0
                        },
                        {
                            "items": [
                                0,
                                1,
                                2,
                                3,
                                4,
                                5,
                                6,
                                7,
                                8,
                                9,
                                10,
                                11,
                                12
                            ],
                            "name": "Habitat 4",
                            "index": 3,
                            "temperature": 0,
                            "pipelength": 0,
                            "brickarea": 0
                        }
                    ]
                },
                buttonSelectors: {
                    type: Array,
                    notify: true,
                    value: [
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/species_00.svg",
                            "index": 0,
                            "color": "#FFC91B"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/species_01.svg",
                            "index": 1,
                            "color": "#5A6372"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/species_02.svg",
                            "index": 2,
                            "color": "#FFDD00"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/species_03.svg",
                            "index": 3,
                            "color": "#2C4721"
                        },
                        {
                            "imgUrl": "http://ltg.cs.uic.edu/WC/icons/species_04.svg",
                            "index": 4,
                            "color": "#502B6E"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/species_05.svg",
                            "index": 5,
                            "color": "#99cc33"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/species_06.svg",
                            "index": 6,
                            "color": "#8975B5"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/species_07.svg",
                            "index": 7,
                            "color": "#FAAA19"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/species_08.svg",
                            "index": 8,
                            "color": "#899C7C"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/species_09.svg",
                            "index": 9,
                            "color": "#4AB6C8"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/species_10.svg",
                            "index": 10,
                            "color": "#68734F"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/env_temp.svg",
                            "index": 11,
                            "color": "#FF5722"
                        },
                        {
                            "imgUrl": "https://ltg.cs.uic.edu/WC/icons/env_pipes.svg",
                            "index": 12,
                            "color": "#795548"
                        }

                    ]
                },
                connected: {
                    type: Boolean,
                    notify: true,
                    value: false,
                    observer: 'connectedChanged'
                },
            },
            observers: [
                'selectedItemsChanged(selectedItems.*)',
                'toggleSelectorsChanged(toggleSelectors.*)',
                'buttonSelectorsChanged(buttonSelectors.*)'
            ],
            selectedItemsChanged: function (changeRecord) {
                if (changeRecord.path == 'selectedItems.splices') {
                    // a user was added or removed
                } else {
                    // an individual user or its sub-properties changed
                    // check "changeRecord.path" to determine what changed
                }
            },
            testSwitchTapped: function (e) {
                this.$.ws.switchToggleAndButtonSelectors(3, [0, 4, 5]);
            },
            toggleSelectorsChanged: function (changeRecord) {

            },
            buttonSelectorsChanged: function (changeRecord) {

            },
            currentToggleChanged: function (newValue, oldValue) {
//                console.log('toggle changed test-app', newValue, oldValue);
            },
            connectedChanged: function (newValue, oldValue) {
                var me = this;
//                console.log('connected changed', newValue, oldValue);
                if (newValue === true) {
                    this.$.nutellaConn.nutella.net.request('master_configuration_test', {}, function (r) {
                        if (r !== undefined) {
                            me.buttonSelectors = r.habitatItems;

                            var start = [{
                                'items': [],
                                'name': 'Habitat ?  ',
                                'index': -1
                            }];
                            me.toggleSelectors = start.concat(r.habitats);
                            console.log('MASTER CONFIG FETCHED');

                        }

                    });
                }
            },
            forceMe: function (e) {
                this.$.ws.switchToggleAndButtonSelectors(-1, []);
            },
            ready: function () {
                this.selectedItems = [];

                var start = [{
                    'items': [],
                    'name': 'Habitat ?  ',
                    'index': -1
                }];
                this.toggleSelectors = start.concat(this.toggleSelectors);
                this.buttonSelectors = [];
                this.toggleSelectors = [];
            }
        });
    </script>
</dom-module>
